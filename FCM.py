import streamlit as st
from pptx import Presentation
from pptx.util import Pt, Inches
from pptx.enum.text import PP_ALIGN
from io import BytesIO

def create_large_font_ppt():
    prs = Presentation()

    # --- æ ¸å¿ƒæ”¹è‰¯ï¼šè‡ªå®šç¾©ç‰ˆé¢å‡½å¼ ---
    def add_slide(title, content_list):
        # ä½¿ç”¨ "Title Only" ç‰ˆå‹ (Layout 5)ï¼Œè®“æˆ‘å€‘å¯ä»¥è‡ªå·±ç•«æ–‡å­—æ¡†
        slide_layout = prs.slide_layouts[5] 
        slide = prs.slides.add_slide(slide_layout)
        
        # 1. è¨­å®šæ¨™é¡Œ (å­—é«”åŠ å¤§åˆ° 40)
        title_shape = slide.shapes.title
        title_shape.text = title
        title_shape.text_frame.paragraphs[0].font.size = Pt(40)
        title_shape.text_frame.paragraphs[0].font.bold = True
        
        # 2. æ‰‹å‹•å»ºç«‹æœ€å¤§åŒ–çš„å…§æ–‡æ¡† (é˜²æ­¢å­—é«”è®Šå¤§å¾Œæº¢å‡º)
        # ä½ç½®ï¼šå·¦ 0.5å‹, ä¸Š 1.5å‹, å¯¬ 9å‹, é«˜ 5.5å‹ (æ¨™æº– PPT å¯¬åº¦æ˜¯ 10å‹)
        left = Inches(0.5)
        top = Inches(1.4)
        width = Inches(9.0)
        height = Inches(5.5)
        
        textbox = slide.shapes.add_textbox(left, top, width, height)
        tf = textbox.text_frame
        tf.word_wrap = True # è‡ªå‹•æ›è¡Œ
        
        for item in content_list:
            p = tf.add_paragraph()
            p.text = item
            p.font.size = Pt(28) # æ”¹è‰¯ï¼šå…§æ–‡åŠ å¤§è‡³ 28
            p.space_after = Pt(14) # æ®µè½é–“è·
            
            # è™•ç†ç¸®æ’ (ç°¡å–®é‚è¼¯)
            if item.strip().startswith("-") or item.strip().startswith("â€¢"):
                 p.level = 1
                 p.font.size = Pt(26) # ç¬¬äºŒå±¤ç¸®æ’å­—ç¨å¾®å°ä¸€é»é»ï¼Œæ›´æœ‰å±¤æ¬¡

    # --- æŠ•å½±ç‰‡å…§å®¹ (é…åˆå¤§å­—é«”ï¼Œå…§å®¹ç¶“éå¾®èª¿èˆ‡æ‹†åˆ†) ---

    # Slide 1: å°é¢
    slide = prs.slides.add_slide(prs.slide_layouts[0])
    title = slide.shapes.title
    subtitle = slide.placeholders[1]
    title.text = "ç®¡ç†çµ„ç¹”çš„ç”Ÿå­˜ç’°å¢ƒ\nç”Ÿæ…‹èˆ‡é«”åˆ¶ç†è«–"
    subtitle.text = "Chapter 06\nçµ„ç¹”å¦‚ä½•åœ¨å¢æ—èˆ‡ç¤¾æœƒä¸­æ±‚ç”Ÿï¼Ÿ"
    
    # é‡å°å°é¢æ‰‹å‹•åŠ å¤§
    title.text_frame.paragraphs[0].font.size = Pt(54)
    subtitle.text_frame.paragraphs[0].font.size = Pt(32)

    # Slide 2: å‰è¨€
    add_slide("çµ„ç¹”ç”Ÿå­˜çš„é›™é‡æˆ°å ´", [
        "çµ„ç¹”æ´»åœ¨å…©å€‹å¤–éƒ¨ç’°å¢ƒä¸­ï¼š",
        "1. ç”Ÿç‰©å¢æ— (çµ„ç¹”ç”Ÿæ…‹ç†è«–)ï¼š",
        "   - é—œæ³¨è³‡æºç«¶çˆ­ã€ç’°å¢ƒè² è¼‰åŠ›ã€‚",
        "   - æ ¸å¿ƒï¼šé©è€…ç”Ÿå­˜ï¼Œä½ç½®æ±ºå®šå‘½é‹ã€‚",
        "2. äººé¡ç¤¾æœƒ (é«”åˆ¶ç†è«–)ï¼š",
        "   - é—œæ³¨ç¤¾æœƒè¦ç¯„ã€åƒ¹å€¼è§€ã€æ­£ç•¶æ€§ã€‚",
        "   - æ ¸å¿ƒï¼šåˆä¹ç¦®æ•™è€…ç”Ÿå­˜ï¼Œæ±‚èªåŒã€‚"
    ])

    # Slide 3: ç”Ÿæ…‹ç†è«–
    add_slide("Part I: çµ„ç¹”ç”Ÿæ…‹ç†è«–", [
        "æ ¸å¿ƒè§€é»ï¼šè‡ªç„¶é¸æ“‡ (Natural Selection)",
        "   - çµ„ç¹”åƒç”Ÿç‰©ï¼Œé›£ä»¥ã€Œå³æ™‚ã€æ”¹è®Šæ ¸å¿ƒã€‚",
        "   - ç”Ÿæ­»é—œéµåœ¨æ–¼ï¼šæ˜¯å¦é©åˆè©²ç’°å¢ƒ (Fit)ã€‚",
        "å®šç¾©ï¼šçµ„ç¹”æ—ç¾¤ (Population)",
        "   - ç«¶çˆ­ç›¸åŒè³‡æºçš„åŒé¡çµ„ç¹”ã€‚",
        "   - ä¾‹å¦‚ï¼šæ°´æ³¥æ¥­ã€é€£é–é¤é£²æ¥­ã€‚"
    ])

    # Slide 4: è² è¼‰åŠ›
    add_slide("å¢æ—æ³•å‰‡ï¼šç’°å¢ƒè² è¼‰åŠ›èˆ‡å¯†åº¦", [
        "ç’°å¢ƒè² è¼‰èƒ½åŠ› (Carrying Capacity)",
        "   - æ± å¡˜èƒ½é¤Šå¤šå°‘é­šæœ‰ä¸Šé™ (å—é™è³‡æº/æ³•ä»¤)ã€‚",
        [cite_start]"æ—ç¾¤å¯†åº¦ (Population Density) æ•ˆæ‡‰ [cite: 112-114]",
        "   - åˆæœŸ (æ­£ç•¶æ€§)ï¼šå» å•†å¤šï¼Œé¤…åšå¤§ï¼Œåˆ©ç”Ÿå­˜ã€‚",
        "   - å¾ŒæœŸ (ç«¶çˆ­æ€§)ï¼šå» å•†éå¤šï¼Œè³‡æºç¨€é‡‹ï¼Œæ­»äº¡ç‡é«˜ã€‚"
    ])

    # Slide 5: é†«ç™‚å€‹æ¡ˆ (ä¸Š) - ç¾è±¡
    add_slide("ã€å€‹æ¡ˆã€‘å°ç£é†«ç™‚æ©Ÿæ§‹æ¶ˆé•· (1/2)", [
        [cite_start]"å¸‚å ´ç¾è±¡ (2004-2014) [cite: 20-30]ï¼š",
        "   - éœ€æ±‚é¢ï¼šäººå£è€åŒ–ï¼Œé†«ç™‚ç”¢å€¼å‡ã€‚",
        "   - ä¾›çµ¦é¢ï¼šå¤§é†«é™¢æ¸› 12.6%ï¼Œè¨ºæ‰€å¤§å¢ã€‚",
        "ç‚ºä½•ç”¢ç”Ÿæ­¤è®ŠåŒ–ï¼Ÿ",
        "   - ç’°å¢ƒè®Šé·å°è‡´ã€Œå¤§å‹ç‰©ç¨®ã€é›£ä»¥ç”Ÿå­˜ã€‚",
        "   - ã€Œéˆæ´»å°å‹ç‰©ç¨®ã€(è¨ºæ‰€) å–ä»£ç”Ÿæ…‹ä½ã€‚"
    ])
    
    # Slide 6: é†«ç™‚å€‹æ¡ˆ (ä¸‹) - åŸå› 
    add_slide("ã€å€‹æ¡ˆã€‘å°ç£é†«ç™‚æ©Ÿæ§‹æ¶ˆé•· (2/2)", [
        [cite_start]"å¤§é†«é™¢é¢è‡¨çš„ç’°å¢ƒé™åˆ¶ [cite: 39-47]ï¼š",
        "1. äººåŠ›è³‡æºå›°å¢ƒï¼š",
        "   - è­·ç†äººå“¡é…ç½®è®Šåš´ï¼ŒäººåŠ›åš´é‡çŸ­ç¼ºã€‚",
        "2. è²¡å‹™è³‡æºå›°å¢ƒï¼š",
        "   - å¥ä¿ç¸½é¡æ”¯ä»˜å°è‡´é»å€¼ç¨€é‡‹ (<1å…ƒ)ã€‚",
        "çµè«–ï¼šç’°å¢ƒè² è¼‰åŠ›æ”¹è®Šï¼Œçµ„ç¹”å¿…é ˆè½‰å‹ã€‚"
    ])

    # Slide 7: çµæ§‹æ…£æ€§
    add_slide("çµæ§‹æ…£æ€§ï¼šç‚ºä»€éº¼å¤§è±¡é›£è·³èˆï¼Ÿ", [
        [cite_start]"çµæ§‹æ…£æ€§ (Structural Inertia) [cite: 99-109]ï¼š",
        "   - çµ„ç¹”ä¸æ˜“æ”¹è®Šæ ¸å¿ƒå½¢å¼çš„å‚¾å‘ã€‚",
        "æ…£æ€§çš„é›™é¢åˆƒï¼š",
        "   - å„ªé»ï¼šå»ºç«‹å¯é æ€§èˆ‡èª²è²¬æ€§ (å®¢æˆ¶ä¿¡ä»»)ã€‚",
        "   - ç¼ºé»ï¼šç’°å¢ƒåŠ‡è®Šæ™‚ç„¡æ³•åæ‡‰ (è€åŒ–é¢¨éšª)ã€‚",
        "æ–°å‰µé¢¨éšªï¼šéˆæ´»ä½†ç¼ºä¹ç©©å®šç³»çµ±ï¼Œæ­»äº¡ç‡é«˜ã€‚"
    ])

    # Slide 8: ç¶“ç‡Ÿç­–ç•¥
    add_slide("ç”Ÿå­˜ç­–ç•¥ï¼šç‘å£«åˆ€ vs. æ‰‹è¡“åˆ€", [
        [cite_start]"å»£æ³›ç¶“ç‡Ÿè€… (Generalist) [cite: 137]ï¼š",
        "   - è³‡æºå¤šï¼Œåˆ†æ•£é¢¨éšªï¼Œåƒå¤§å¸‚å ´ (å¦‚:é‡‘æ§)ã€‚",
        "   - é©åˆè®Šå‹•å¤§ä¸”é•·çš„ç’°å¢ƒã€‚",
        [cite_start]"å°ˆç²¾ç¶“ç‡Ÿè€… (Specialist) [cite: 140]ï¼š",
        "   - è³‡æºå°‘ï¼Œæ·±è€•å°åˆ©åŸº (å¦‚:å°ˆç§‘è¨ºæ‰€)ã€‚",
        "   - é©åˆç©©å®šç’°å¢ƒï¼Œæ•ˆç‡æ¥µé«˜ã€‚"
    ])

    # Slide 9: èˆªç©ºå€‹æ¡ˆ
    [cite_start]add_slide("ã€å€‹æ¡ˆã€‘èˆªç©ºæ¥­çš„è³‡æºåˆ†å‰² [cite: 251-262]", [
        "ç«‹æ¦®èˆªç©º (å»£æ³›è€…)ï¼š",
        "   - ç¶“ç‡Ÿ 14 æ¢èˆªç·šï¼Œèˆ‡è¯ä¿¡/é æ±æ¿€çƒˆç«¶çˆ­ã€‚",
        "å¾·å®‰èˆªç©º (å°ˆç²¾è€…)ï¼š",
        "   - å°ˆæ³¨å°æ±-è˜­å¶¼/ç¶ å³¶ç­‰é›¢å³¶èˆªç·šã€‚",
        "   - èˆ‡å…¶ä»–å®¶ã€Œé›¶é‡ç–Šã€ï¼Œäº«æœ‰ç¨ä½”åˆ©åŸºã€‚",
        "å•Ÿç¤ºï¼šå°è¦ç±³ä¸è¦è·Ÿé¯¨é­šç¡¬ç¢°ç¡¬ï¼Œæ‰¾ç¸«éš™ç”Ÿå­˜ã€‚"
    ])

    # Slide 10: ç´…çš‡åæ•ˆæ‡‰
    add_slide("ç´…çš‡åæ•ˆæ‡‰ (Red Queen Effect)", [
        [cite_start]"ã€Œä½ å¿…é ˆç›¡å…¨åŠ›å¥”è·‘ï¼Œæ‰èƒ½ä¿æŒåœ¨åŸåœ°ã€‚ã€[cite: 168]",
        "å«ç¾©ï¼š",
        "   - å°æ‰‹è®Šå¼·ï¼Œä½ é€²æ­¥åªæ˜¯ç‚ºäº†ã€Œä¸è¢«æ·˜æ±°ã€ã€‚",
        "   - ç›¸å°å„ªå‹¢ä¸¦æœªæ”¹è®Š (è»å‚™ç«¶è³½)ã€‚",
        "å•Ÿç¤ºï¼š",
        "   - åœæ­¢å­¸ç¿’æˆ–é é›¢ç«¶çˆ­ï¼Œç«‹åˆ»æœƒè¢«ç’°å¢ƒæ·˜æ±°ã€‚"
    ])

    # Slide 11: é«”åˆ¶ç†è«–
    add_slide("Part II: é«”åˆ¶ç†è«– (Institutional Theory)", [
        "æ ¸å¿ƒæ¦‚å¿µï¼š",
        "   - ç’°å¢ƒä¸­æœ‰è¨±å¤šå¿…é ˆéµå¾çš„è¦ç¯„ (æ³•ä»¤/ç¿’ä¿—)ã€‚",
        [cite_start]"ç›®çš„ï¼šç²å¾—ã€Œæ­£ç•¶æ€§ã€ï¼Œå³ç¤¾æœƒé€šè¡Œè­‰ [cite: 206]ã€‚",
        "å¾Œæœï¼š",
        "   - é•åè¦ç¯„ = å¤±å»ä¿¡è³´ = è³‡æºæ–·çµ•ã€‚",
        "   - ç‚ºæ±‚ç”Ÿå­˜ï¼Œå¤§å®¶é•·å¾—è¶Šä¾†è¶Šåƒ (åŒå½¢åŒ–)ã€‚"
    ])

    # Slide 12: åŒå½¢åŒ–æ©Ÿåˆ¶
    add_slide("ç‚ºä½•å¤§å®¶é•·å¾—è¶Šä¾†è¶Šåƒï¼Ÿ(åŒå½¢åŒ–)", [
        "1. æ³•è¦æ€§ (Regulative) - ã€Œä¸å¾—ä¸åšã€",
        [cite_start]"   - æ”¿åºœæ³•ä»¤å¼·åˆ¶ (ä¾‹ï¼šç’°ä¿å ±å‘Šæ›¸) [cite: 210]ã€‚",
        "2. è¦ç¯„æ€§ (Normative) - ã€Œæ‡‰è©²è¦åšã€",
        [cite_start]"   - è·æ¥­é“å¾·æ¨™æº– (ä¾‹ï¼šæœƒè¨ˆå¸«ä½œæ¥­é›·åŒ) [cite: 212]ã€‚",
        "3. èªçŸ¥æ€§ (Cognitive) - ã€Œå¤§å®¶éƒ½é€™æ¨£åšã€",
        [cite_start]"   - æ¨¡ä»¿æˆåŠŸè€…æœ€å®‰å…¨ (ä¾‹ï¼šå­¸è±ç”°ç®¡ç†) [cite: 214]ã€‚"
    ])

    # Slide 13: æ­£ç•¶æ€§é¡å‹
    [cite_start]add_slide("æ­£ç•¶æ€§ï¼šçµ„ç¹”çš„ç¤¾æœƒè³‡æœ¬ [cite: 273-280]", [
        "1. å¯¦è³ªåˆ©ç›Šæ­£ç•¶æ€§ï¼š",
        "   - å°åˆ©å®³é—œä¿‚äººæœ‰ç”¨ (ç”¢å“å¥½)ã€‚",
        "2. é“å¾·æ­£ç•¶æ€§ï¼š",
        "   - ç¬¦åˆç¤¾æœƒåƒ¹å€¼ (ç’°ä¿ã€å…¬ç›Š)ã€‚",
        "3. èªçŸ¥æ­£ç•¶æ€§ï¼š",
        "   - åˆä¹å¸¸ç†èˆ‡æœŸå¾… (æ¨™æº–ç¨‹åº)ã€‚"
    ])

    # Slide 14: FB å€‹æ¡ˆ
    [cite_start]add_slide("ã€å€‹æ¡ˆã€‘Facebook çš„é«”åˆ¶å›°å¢ƒ [cite: 328-342]", [
        "æ³•è¦æ€§æŒ‘æˆ°ï¼š",
        "   - æ—©æœŸéš¨æ„å‚³è¼¸å€‹è³‡ï¼Œé•åæ­ç›Ÿæ³•è¦ã€‚",
        "è¦ç¯„æ€§æŒ‘æˆ°ï¼š",
        "   - å‡æ–°èèˆ‡æ“å¼„é¸èˆ‰ï¼Œé•èƒŒé“å¾·ã€‚",
        "å½±éŸ¿ï¼š",
        "   - é“å¾·æ­£ç•¶æ€§å´©ç›¤ï¼Œä¼æ¥­å½¢è±¡å—æã€‚",
        "   - å¼•ä¾†å„åœ‹æ”¿åºœæ›´åš´æ ¼ç›£ç®¡ã€‚"
    ])

    # Slide 15: æ‡‰å°ç­–ç•¥
    [cite_start]add_slide("ç®¡ç†éŒ¦å›Šï¼šé¢å°å£“åŠ›çš„ 4 ç¨®ç­–ç•¥ [cite: 299-311]", [
        "1. éµå¾ (Acquiesce)ï¼šä¹–ä¹–ç…§åš (æœ€å¸¸è¦‹)ã€‚",
        "2. é¸æ“‡ (Select)ï¼šæŒ‘é¸èƒ½æ¥ç´è‡ªå·±çš„å¸‚å ´ã€‚",
        "3. æ“æ§ (Manipulate)ï¼šé€éå»£å‘Š/éŠèªªæ”¹è®Šè¦å‰‡ã€‚",
        "4. ç·©è¡/éš±ç (Buffer/Conceal)ï¼š",
        "   - è¡¨é¢ç¬¦åˆï¼Œå¯¦éš›è„«é‰¤ (é¢¨éšªé«˜)ã€‚",
        "   - å¦‚ï¼šå½¢å¼ä¸Šçš„å“ç®¡ï¼Œå¯¦éš›æœªåŸ·è¡Œã€‚"
    ])

    # Slide 16: çµèª
    add_slide("æœ¬ç« ç¸½çµèˆ‡æ€è€ƒ", [
        "ç”Ÿå­˜å…¬å¼ï¼š",
        "   ç”Ÿå­˜ = (é©åˆçš„ç”Ÿæ…‹åˆ©åŸº) + (ç¤¾æœƒæ­£ç•¶æ€§)",
        "èª²å¾Œæ€è€ƒï¼š",
        "   1. ä½ çš„çµ„ç¹”æ˜¯å»£æ³›è€…(å¤§)é‚„æ˜¯å°ˆç²¾è€…(å°)ï¼Ÿ",
        "   2. ä½ çš„ç”¢æ¥­æœ‰å“ªäº›ã€Œä¸æˆæ–‡è¦å®šã€å¿…é ˆéµå®ˆï¼Ÿ",
        "",
        "~ End of Chapter 06 ~"
    ])

    # å­˜å…¥è¨˜æ†¶é«”
    binary_output = BytesIO()
    prs.save(binary_output)
    binary_output.seek(0)
    return binary_output

# --- Streamlit åŸ·è¡Œå€ ---
st.title("æŠ•å½±ç‰‡ç”Ÿæˆå™¨ (å¤§å­—é«”ç‰ˆ) ğŸ«")
st.write("å·²å„ªåŒ–ï¼šå­—é«”æ”¾å¤§è‡³ 28ptï¼Œç‰ˆé¢æœ€å¤§åŒ–ï¼Œé˜²æ­¢æ–‡å­—æº¢å‡ºã€‚")

if st.button('ğŸš€ ä¸‹è¼‰å¤§å­—é«”ç‰ˆ PPT'):
    ppt_file = create_large_font_ppt()
    
    st.download_button(
        label="ğŸ“¥ ä¸‹è¼‰ Ch06_å¤§å­—é«”ç‰ˆ.pptx",
        data=ppt_file,
        file_name="Ch06_çµ„ç¹”ç”Ÿæ…‹èˆ‡é«”åˆ¶ç†è«–_LargeFont.pptx",
        mime="application/vnd.openxmlformats-officedocument.presentationml.presentation"
    )
    st.success("ç”Ÿæˆå®Œç•¢ï¼ç‰ˆé¢èˆ‡å­—é«”å·²èª¿æ•´ã€‚")
